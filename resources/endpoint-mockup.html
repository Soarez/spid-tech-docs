<div class="section">
  <div class="main">
    <div class="wrap">
      <a class="mod category small faded mbn" href="/">Identity management</a>
      <h1 class="mbn">POST /user</h1>
      <p class="small faded mtn">
        Requires authentication with <strong>server</strong> access token.
      </p>

      <p>
        Creates a new user.
      </p>
      <p>
        Email is a unique value across merchants in SPiD.
        A new user will only be created when both:
      </p>

      <ul>
        <li>the email being posted is new to the system, and</li>
        <li>the posted user is unique.</li>
      </ul>

      <p>
        If no password is provided, one will be generated and emailed to
        the user.
      </p>
    </div>
  </div>
</div>

<div class="separator"></div>

<div class="section">
  <div class="main">
    <div class="wrap">

      <h1 class="mbn">Request</h1>

      <pre><code class="sh">POST /api/2/user</code></pre>

      <table class="sectioned">
        <tr>
          <th><h4>email</h4></th>
          <td>
            <h5>required</h5>
            <p class="faded">User's email address. The user's primary means for logging in. It's displayed alongside the user in your dashboard and can be useful for searching and tracking.</p>
          </td>
        </tr>
        <tr>
          <th><h4>displayName</h4></th>
          <td>
            <h5>optional</h5>
            <p class="faded">User's name, possibly shortened. Used when displaying the user's name.</p>
          </td>
        </tr>
        <tr>
          <th><h4>name</h4></th>
          <td>
            <h5>optional</h5>
            <p class="faded mtn">User's full, legal name.</p>
          </td>
        </tr>
        <tr><th><h4>birthday</h4></th><td></td></tr>
        <tr><th><h4>addresses</h4></th><td></td></tr>
        <tr><th><h4>gender</h4></th><td></td></tr>
        <tr><th><h4>photo</h4></th><td></td></tr>
        <tr><th><h4>preferredUsername</h4></th><td></td></tr>
        <tr><th><h4>url</h4></th><td></td></tr>
        <tr><th><h4>utcOffset</h4></th><td></td></tr>
        <tr><th><h4>redirectUri</h4></th><td></td></tr>
      </table>

    </div>
  </div>

  <div class="aside">
    <div class="wrap">

      <h2 class="mtl">Example request</h2>

      <div class="tabs">
        <h5 class="tab">cURL</h5>
        <div class="tab-content">
          <pre><code class="sh">
$ curl https://payment.schibsted.no/api/2/user \
   -X POST \
   -d "oauth_token=[access token]" \
   -d "email=user@example.com"
</code></pre>
        </div>
        <h5 class="tab">Clojure</h5>
        <div class="tab-content">
          <pre><code class="clj">
(ns example
  (:require [spid-sdk-clojure.core :as sdk]))

(-> (sdk/create-client client-id secret)
  (sdk/POST "/user" {"email" "user@example.com"}))
      </code></pre>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="separator"></div>

<div class="section">
  <div class="main">
    <div class="wrap">

      <h1>Response</h1>

      <p>
        This endpoint supports <a href="/">JSON</a> and <a href="/">JSONP</a> response formats.
      </p>

      <h2>Success: 201 Created</h2>

      <p>The newly created <strong>User</strong> is returned.</p>

      <p>
        The user object is based on the portable contacts
        specification. It is extended with some custom fields. userId is
        an integer and represents the unique user ID. id is a legacy
        uuid and should be ignored in new integrations. The email and
        phoneNumber fields will always contain the primary used for both
        if available. The corresponding *Verified fields are the date of
        the last time those were verified.
      </p>
      <p>
        The check mark <span class="check">✓</span> indicates if the field always contains
        a valid non-empty value.
      </p>

      <table class="sectioned mbl">
        <tr>
          <th><h4 class="nowrap">status <span class="check">✓</span></h4></th>
          <td>
            <h5><a href="/">user-status</a></h5>
          </td>
        </tr>
        <tr>
          <th><h4 class="nowrap">lastLoggedIn <span class="check">✓</span></h4></th>
          <td>
            <h5>string</h5>
          </td>
        </tr>
        <tr>
          <th><h4 class="nowrap">emails <span class="check">✓</span></h4></th>
          <td>
            <h5>list of strings</h5>
          </td>
        </tr>
        <tr>
          <th><h4 class="nowrap">userId <span class="check">✓</span></h4></th>
          <td>
            <h5>integer</h5>
            <p class="faded">Unique user ID. Custom extension.</p>
          </td>
        </tr>
        <tr>
          <th><h4 class="nowrap">locale <span class="check">✓</span></h4></th>
          <td>
            <h5>string</h5>
            <p class="faded">The locale used by the user. Locales follow ISO Language and country codes respectively, joined by an underscore.</p>
          </td>
        </tr>
        <tr>
          <th><h4 class="nowrap">birthday <span class="check">✓</span></h4></th>
          <td>
            <h5>string</h5>
            <p class="faded">Date of birth in YYYY-MM-DD format. Year will be 0000 if not provided. Defaults to 0000-00-00. Portable contacts.</p>
          </td>
        </tr>
      </table>

      <h2>Failure cases</h2>

      <ul>
        <li><strong>401 Unauthorized</strong> <span class="faded">Your server access token is missing or invalid. Try re-authenticating.</span></li>
        <li><strong>403 Forbidden</strong> <span class="faded">You're not allowed to create users. Contact SPiD to be granted access.</span> </li>
        <li><strong>418 I'm a teapot</strong> <span class="faded">Why are you contacting your teapot instead of the SPiD servers? Silly rabbit.</span></li>
      </ul>
    </div>

  </div>
  <div class="aside">
    <div class="wrap">

      <h2 class="mtl">Sample response</h2>

      <div class="tabs">
        <h5 class="tab">JSON</h5>
        <div class="tab-content">
          <pre><code class="json">
[{"status": "true",
  "referer": "https://stage.payment.schibsted.no/login",
  "clientId": "[Your client ID]",
  "trackingRef": false,
  "userId": [0, 0, 0, 1, 3, 2],
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.107 Safari/537.36",
  "hash": "93bd98f00b52f3d3e26fe6852091d1c2",
  "trackingTag": false,
  "merchantId": "[Your merchant ID]",
  "created": "2014-02-20 09:35:34",
  "email": "user@domain.tld",
  "type": "normal",
  "initialReferer": "https://stage.payment.schibsted.no/account/summary",
  "provider": "default",
  "id": "150005945",
  "ip": "127.0.0.1"}]
</code></pre>
        </div>
        <h5 class="tab">JSONP</h5>
        <div class="tab-content">
          <pre><code class="js">
callback([{"status": "true",
  "referer": "https://stage.payment.schibsted.no/login",
  "clientId": "[Your client ID]",
  "trackingRef": false,
  "userId": [0, 0, 0, 1, 3, 2],
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.107 Safari/537.36",
  "hash": "93bd98f00b52f3d3e26fe6852091d1c2",
  "trackingTag": false,
  "merchantId": "[Your merchant ID]",
  "created": "2014-02-20 09:35:34",
  "email": "user@domain.tld",
  "type": "normal",
  "initialReferer": "https://stage.payment.schibsted.no/account/summary",
  "provider": "default",
  "id": "150005945",
  "ip": "127.0.0.1"}]);
</code></pre>
        </div>
      </div>
    </div>
  </div>
</div>
