:title Managing User-Specific Properties or Traits

:aside

## Read more about Mixpanel

- [Mixpanel Analytics](/mixpanel/analytics/)
- [Events tracked by SPiD](/mixpanel/events-tracked/)
- [Mixpanel Page Viewed Event](/mixpanel/page-viewed-event/)
- [Implementing Mixpanel tracking](/mixpanel/implementing-tracking/)

:body

Mixpanel supports tracking of
[user-specific properties](https://mixpanel.com/docs/managing-users/managing-user_specific-properties)
on events and people tracking. In order to append these properties to all events
tracked when the user is redirected to SPiD for login/signup or payment flows,
the client service needs to relay these properties to SPiD. This can be done
client side via the [JS SDK](/sdks/javascript/) or through our
[REST-based APIs](/endpoints/). If done client-side via the JS SDK, SPiD will
add these properties to all events generated by SPiD for that visitor. If the
visitor is a SPiD user or registers as a SPiD user in the process, these
properties will be added to any event generated, regardless of whether the user
is logged in or not (not all events are triggered by the users themselves).

User traits can be managed through the REST-API:
[Create](/endpoints/POST/user/{userId}/traits/),
[list](/endpoints/GET/user/{userId}/traits/), and
[delete](/endpoints/DELETE/user/{userId}/trait/{trait}/).

### Logging traits for users

```sequence-diagram
Browser->Client: Request a page on the client service
Client->Browser: Respond with content
Browser->JS SDK: Initiates JS SDK
JS SDK->SPiD: Checks if current visitor is a SPiD user
SPiD->JS SDK: Returns a unique visitor ID
SPiD->Mixpanel: Track autologin event if user was automatically logged in by the JS SDK
JS SDK->Browser: Trigger the "auth.visitor" event to inform the Client of an identified visitor
Browser->Mixpanel: Track events based on the unique visitor ID returned by the JS SDK
Client->Browser: Pass Mixpanel super properties as a signed traits JSON object to the browser
Browser->SPiD: Send the signed traits JSON object to SPiD via the JS SDK function VGS.setTraits()
SPiD->SPiD: Decode and verify the signature of the provided traits object for authenticity
SPiD->SPiD: Save the provided traits to either the identified user or the session
SPiD->Mixpanel: Tracks SPiD defined events with the attached traits from Client
```

## The traits JSON object

The format of the JSON object consists of one or more key/value pairs where keys
must be strings and values can be strings, booleans, numbers or a JSON array.
See
[Mixpanel's property data types](https://mixpanel.com/docs/properties-or-segments/property-data-types)
for a list of supported types.

### Example JSON object

```js
{ "Subscribed since": "2012-11-20",
  "Newsletter subscriber": true,
  "Goals reached": 12,
  "Account type": "Personal"
}
```

The traits JSON object must then be signed with the client's signature secret
and base64url encoded before passing this data to SPiD client side.
[Signing](#signing-your-traits-json-object) helps prevent tampering of user
traits by a third party.

The traits object can be updated and queried through the following endpoints:

- [`GET` /user/{userId}/traits](/endpoints/GET/user/{userId}/traits/)
    List current traits
- [`POST` /user/{userId}/traits](/endpoints/POST/user/{userId}/traits/)
    Add or update traits
- [`DELETE` /user/{userId}/traits/{trait}](/endpoints/DELETE/user/{userId}/trait/{trait}/)
    Delete a trait by property name
    
    
## Traits and People analytics in Mixpanel

SPiD does not have any traits. Only additional data provided by clients will be
saved as traits and posted on both events and people data in addition to the
properties above. The only SPiD provided profile data posted to People
analytics, in addition to the client provided traits are:

- **Locale** - the user language settings in SPiD
- **Birthday** - if invalid: undisclosed
- **Last authenticated**
- **Last login**

**NOTE:** This information cannot be overwritten by client traits.

## Signing your traits JSON object

We use the same signature scheme that is provided by all responses from SPiD to
the JS SDK. The signature string is a concatenation of a base64url
encoded HMAC-256 hashed signature, hashed with your client signature secret, of
the JSON object provided, a dot (.) and the base64url encoded version of your
provided JSON object. It looks like this:

```text
zOJ7x_oA3EnL4CB5AsgONtWfdF2r_N6c-aLZTaGy-z8.eyJTdWJzY3JpYmVkIHNpbmNlIjoiMjAxMi0xMS0yMCIsIk5ld3NsZXR0ZXIgc3Vic2NyaWJlciI6dHJ1ZSwiR29hbHMgcmVhY2hlZCI6MTIsIkFjY291bnQgdHlwZSI6IlBlcnNvbmFsIiwiYWxnb3JpdGhtIjoiSE1BQy1TSEEyNTYiLCJ0IjoxMzcyMTUwMjU3LjExfQ
```

The signed data has two parts:

```text
<signature>.<data>
```

To sign the object, perform the following steps:

1. JSON stringify the object
2. Create an HMAC SHA256 hash of the stringified JSON object with your client signing secret
3. Base64 URL encode the raw hash data - this is your signature
4. Base64 URL encode your stringified JSON object - this is your payload
4. Concatenate the signature, a dot and the payload

See also [signed responses](/endpoints/#signed-responses), and signing in
[callback requests](/callbacks/), both of which use the same basic algorithm.

