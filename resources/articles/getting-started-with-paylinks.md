:title Getting started with Paylinks

:aside

## Prerequisites

In order to complete this guide, you need to know your:

- client ID
- API secret

You should also have gone through the
[Getting Started](/getting-started/) guide, in particular that you
have downloaded and installed the appropriate SDK for your platform.

:body

When you have completed this guide, you can sell products by allowing users to
check out and pay via SPiD.

## Overview

This is the flow:

- The user chooses products on your website.
- You send the list of items to SPiD, and get a unique URL back. Redirect the
  user to this Paylink URL.
- The user completes payment on the SPiD website, and is redirected back to your site with an order ID.
- You use the order ID to track the status of payment.

We'll look at this in detail in the rest of the guide. If you prefer to just
dive in, take a look at [these working examples](#working-examples).

## Configure your application

These variables change between production and staging environments:

- Your client ID
- Your client secret
- Your client signature secret
- The base URL to SPiD
- Your base URL

How you choose to configure your application is up to you, but
these variables should not be hard coded.

## The user chooses products on your website

Here are some things to keep in mind when implementing this on your site:

- Before you create the Paylink, you need to know what items the user wants to purchase,
  as well as the price, VAT and quantities of each.
- SPiD will present the user with a summary of the items, and a total price.
  Quantities can not be changed at this point.

In the example, we're keeping it simple with three products - each with an input
field to specify quantity:

<spid-example lang="html" repo="clj" src="/paylinks/resources/index.html" title="Keeping product choices simple"/>

## Send the list of items to SPiD

We prepare the purchase by creating a Paylink - which has a URL to which we can
redirect the user for payment.

To create a Paylink, SPiD expects a few parameters:

- `items` A list of items as a JSON-string, each item with: `description`, `price`, `vat` and `quantity`
- `title` A description shown to the user on the payment page.
- `redirectUri` Where SPiD should send the user after a successful payment
- `cancelUri` Where SPiD should send the user after a cancelled payment
- `clientReference` Your reference, for tracking and processing the order generated by this PayLink

We'll take the quantities posted by the user, and create the data.

#### :tabs Create Paylink data:

##### :tab Clojure

<spid-example lang="clj" src="/paylinks/src/spid_clojure_paylinks_example/core.clj" title="The entirety of our product catalog right here"/>

<spid-example lang="clj" src="/paylinks/src/spid_clojure_paylinks_example/core.clj" title="Create data to POST to /paylink"/>

#### :/tabs

Note that the items are encoded as a JSON string.

With our data in hand, we can create the Paylink by POSTing to
[the /paylinks endpoint](/endpoints/POST/paylink/).

#### :tabs Create paylink

##### :tab Clojure

<spid-example lang="clj" src="/paylinks/src/spid_clojure_paylinks_example/core.clj" title="Create SPiD client"/>

<spid-example lang="clj" src="/paylinks/src/spid_clojure_paylinks_example/core.clj" title="Create Paylink"/>

#### :/tabs

## Redirect the user to SPiD for payment

Our new Paylink has [quite a few fields](/types/paylink/), but the one we're
interested in is the `shortUrl`. We'll use this to send the user to SPiD for
payment.

#### :tabs Redirect to SPiD

##### :tab Clojure

<spid-example lang="clj" src="/paylinks/src/spid_clojure_paylinks_example/core.clj" title="Create Paylink and redirect to SPiD"/>

#### :/tabs

The user will be presented with a summary of the order, along with payment options.

## Working examples

If you're unsure on certain details after reading this guide, do check
out these working examples:

- [Paylinks example for PHP](https://github.com/schibsted/spid-php-examples/tree/master/paylinks)
- [Paylinks example for Java](https://github.com/schibsted/spid-java-examples/tree/master/paylinks)
- [Paylinks example for Clojure](https://github.com/schibsted/spid-clj-examples/tree/master/paylinks)
